In the name of God

# Recovery

- sudo -s
  - systemctl stop mysqld.service

  - mysqld_safe (Maybe with `--socket=...`)
    - To stop:
      - kill `cat /usr/local/mysql/data/server-37-152-191-52.da.direct.pid`

    - Reset password: (https://dev.mysql.com/doc/refman/8.0/en/resetting-permissions.html)
      - Method 1:
        - cat "ALTER USER 'root'@'localhost' IDENTIFIED BY 'abc';" > /tmp/a
        - With `--init-file=/tmp/a`
      - Method 2:
        - With `--skip-grant-tables`
        - mysql (Maybe with `--socket=...`)
          - FLUSH PRIVILEGES;
          - ALTER USER 'root'@'localhost' IDENTIFIED BY 'abc';

  - Dump: (Maybe with `--socket=...`)
    - mysqldump DB_NAME > dump-DB_NAME.sql
    - mysql --database=NEW_DB_NAME < dump-DB_NAME.sql
    - mysqldump --all-databases > dump-all.sql

  - mysql:
    - -u USER_NAME
    - -p (enter password)
    - -pPASSWORD (no space)
    - --database=
    - --socket=...

  - Faulty database cleanup and recreate:
    - mysqld_safe --innodb-force-recovery=6
    - Dump the data.
    - ls -l /usr/local/mysql/data (Find the link destination!)
    - apack mysql-data.tar /var/lib/mysql
    - als mysql-data.tar
    - rm -r /var/lib/mysql
    - Most likely unnecessary: `mkdir /var/lib/mysql` `chown mysql:mysql /var/lib/mysql` `chmod 711 /var/lib/mysql`
    - /usr/local/mysql/scripts/mysql_install_db --user=mysql
    - mysql_secure_installation
    - Restore the dump.

# Commands

- CREATE USER 'user'@'%' IDENTIFIED WITH mysql_native_password USING PASSWORD('abc');
- GRANT ALL ON user.* TO 'database'@'%';
- GRANT ALL ON *.* TO 'db'@'%';
- CREATE DATABASE database DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
